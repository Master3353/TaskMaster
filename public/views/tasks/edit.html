<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="/public/styles/tasks.css">
    <title>Edit Task - TaskMaster</title>
</head>
<body>
    <nav>
        <div class="nav-brand">
            <h2>TaskMaster</h2>
        </div>
        
        <div class="nav-links">
            <a href="/tasks">Dashboard</a>
            <a href="/tasks">My Tasks</a>
            <a href="/tasks/create">Projects</a>
            <a href="#">Calendar</a>
            <a href="#">Settings</a>
        </div>
        
        <div class="nav-user">
            <div class="nav-user-info">
                <div class="nav-user-avatar">
                    <?= strtoupper(substr($user['firstname'], 0, 1) . substr($user['lastname'], 0, 1)) ?>
                </div>
                <div class="nav-user-details">
                    <span class="nav-user-name"><?= htmlspecialchars($user['firstname'] . ' ' . $user['lastname']) ?></span>
                    <span class="nav-user-email"><?= htmlspecialchars($user['email']) ?></span>
                </div>
            </div>
            <?php if ($user['role'] === 'admin'): ?>
                <a href="/admin">Admin Panel</a>
            <?php endif; ?>
            <a href="/logout">Logout</a>
        </div>
    </nav>

    <div class="main-content">
        <div class="page-header">
            <h1>Edit Task</h1>
            <p class="page-subtitle">Update your task details</p>
        </div>

        <form method="POST" action="/tasks/update/<?= $task['id'] ?>">
            <?php if(isset($messages)): ?>
                <p class="messages">
                    <?= htmlspecialchars($messages) ?>
                </p>
            <?php endif; ?>

            <label for="task_name">Task Name</label>
            <input name="task_name" id="task_name" type="text" 
                   placeholder="Enter task name" 
                   value="<?= htmlspecialchars($task['task_name']) ?>" 
                   required maxlength="200" />
            
            <label for="description">Description</label>
            <textarea name="description" id="description" 
                      placeholder="Enter task description" 
                      rows="5"><?= htmlspecialchars($task['description'] ?? '') ?></textarea>
            
            <label for="due_date">Due Date</label>
            <input name="due_date" id="due_date" type="date" 
                   value="<?= htmlspecialchars($task['due_date'] ?? '') ?>" />
            
            <label for="priority_id">Priority</label>
            <div style="display: flex; gap: 0.75rem; margin-bottom: 1rem;">
                <?php foreach ($priorities as $priority): ?>
                    <label class="priority-option" style="flex: 1;">
                        <input type="radio" name="priority_id" value="<?= $priority['id'] ?>" 
                               <?= ($task['priority_id'] == $priority['id']) ? 'checked' : '' ?>
                               style="display: none;" class="priority-radio">
                        <div class="priority-button priority-<?= strtolower($priority['name']) ?>">
                            <?= htmlspecialchars($priority['name']) ?>
                        </div>
                    </label>
                <?php endforeach; ?>
            </div>
            
            <label for="status_id">Status</label>
            <select name="status_id" id="status_id" required>
                <?php foreach ($statuses as $status): ?>
                    <option value="<?= $status['id'] ?>" 
                            <?= ($task['status_id'] == $status['id']) ? 'selected' : '' ?>>
                        <?= htmlspecialchars($status['name']) ?>
                    </option>
                <?php endforeach; ?>
            </select>

            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button type="submit" class="btn btn-primary">Save Changes</button>
                <a href="/tasks" class="btn btn-edit">Cancel</a>
                <form method="POST" action="/tasks/delete/<?= $task['id'] ?>" style="display: inline; margin-left: auto;">
                    <button type="submit" class="btn btn-small btn-delete" 
                            onclick="return confirm('Are you sure you want to delete this task?')">
                        Delete Task
                    </button>
                </form>
            </div>
        </form>
    </div>

</body>
</html>